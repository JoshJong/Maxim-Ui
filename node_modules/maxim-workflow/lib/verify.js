var csslint = require('csslint').CSSLint;
var fs = require('fs');
var common = require('./common.js');

module.exports = {
    verifyFile: function (file) {

        console.log(file);

        //判断file是否为文件
        try {
            var content = fs.readFileSync(file, 'utf8');
            //直接调用字符串校验的方法
            return this.verifyString(content);
        } catch (e) {
            //文件不存在
            console.log('file not exist');
            return {
                status: false,
                message: '文件不存在'
            };
        }
    },
    verifyString: function (str) {
        var vResult = csslint.verify(str);
        var messages = vResult.messages;
        //错误结果集
        var errors = [];
        var errMessage = '';
        messages.map(msg => {
            if (msg.type == 'error') {
                errors.push(msg);
            }
        });
        if (errors.length > 0) {
            //存在校验错误的情况
            errors.map(err => {
                errMessage += err.line + '行' + err.col + '列，检测到错误：' + err.message + common.getCurrentPlat().enter;
            });
            return {
                status: false,
                message: errMessage
            }
        } else {
            //警告目前暂不处理
            return {
                status: true
            };
        }
    }
};